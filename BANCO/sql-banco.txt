CREATE TABLE usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    senha VARCHAR(255) NOT NULL,
    telefone VARCHAR(20),
    perfil_id INT NOT NULL,
    ativo TINYINT(1) DEFAULT 1,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE perfis (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(50) NOT NULL UNIQUE
);

ALTER TABLE perfis
ADD COLUMN css_class VARCHAR(50) NOT NULL AFTER nome;

ALTER TABLE perfis
ADD COLUMN icon VARCHAR(50) NOT NULL AFTER css_class;

UPDATE perfis SET css_class = 'admin',      icon = 'shield-lock-fill' WHERE id = 1;
UPDATE perfis SET css_class = 'individual', icon = 'person-fill'      WHERE id = 2;
UPDATE perfis SET css_class = 'operador',   icon = 'gear-fill'        WHERE id = 3;
UPDATE perfis SET css_class = 'equipe',     icon = 'people-fill'      WHERE id = 4;

CREATE TABLE equipes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    contato VARCHAR(100),
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE tipos_quadra (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(50) NOT NULL
);

CREATE TABLE quadras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    tipo_id INT NOT NULL,
    status ENUM('Disponível', 'Ocupada', 'Manutenção') DEFAULT 'Disponível',
    criada_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (tipo_id) REFERENCES tipos_quadra(id)
);

INSERT INTO tipos_quadra (id, nome) VALUES
(1, 'Futsal'),
(2, 'Basquete'),
(3, 'Vôlei'),
(4, 'Tênis'),
(5, 'Poliesportiva');

CREATE TABLE horarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    hora_inicio TIME NOT NULL,
    hora_fim TIME NOT NULL
);

CREATE TABLE agendamentos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    data DATE NOT NULL,
    horario_id INT NOT NULL,
    quadra_id INT NOT NULL,
    usuario_id INT NULL,
    equipe_id INT NULL,
    duracao INT DEFAULT 1,
    status ENUM('Confirmado', 'Pendente', 'Cancelado') DEFAULT 'Confirmado',
    observacoes TEXT,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (horario_id) REFERENCES horarios(id),
    FOREIGN KEY (quadra_id) REFERENCES quadras(id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    FOREIGN KEY (equipe_id) REFERENCES equipes(id)
);

CREATE TABLE configuracoes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome_organizacao VARCHAR(150),
    cnpj VARCHAR(20),
    email VARCHAR(100),
    telefone VARCHAR(20),
    endereco TEXT
);

CREATE TABLE logs_sistema (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT,
    acao VARCHAR(255),
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);
